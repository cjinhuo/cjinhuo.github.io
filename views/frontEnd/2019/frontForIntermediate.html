<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>中级前端工程师 | cjinhuo</title>
    <meta name="description" content="Searching for meaning">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.38133fe5.css" as="style"><link rel="preload" href="/assets/js/app.f855a051.js" as="script"><link rel="preload" href="/assets/js/3.a8cb06ec.js" as="script"><link rel="preload" href="/assets/js/1.26bd7cad.js" as="script"><link rel="preload" href="/assets/js/9.95c7eff9.js" as="script"><link rel="prefetch" href="/assets/js/10.0ebcd8c7.js"><link rel="prefetch" href="/assets/js/11.fe13ba92.js"><link rel="prefetch" href="/assets/js/12.131626b0.js"><link rel="prefetch" href="/assets/js/13.5873fe99.js"><link rel="prefetch" href="/assets/js/14.895b4459.js"><link rel="prefetch" href="/assets/js/15.87bf91f7.js"><link rel="prefetch" href="/assets/js/16.87c4d7d6.js"><link rel="prefetch" href="/assets/js/17.8db885cd.js"><link rel="prefetch" href="/assets/js/18.97d16c37.js"><link rel="prefetch" href="/assets/js/19.71b00fcb.js"><link rel="prefetch" href="/assets/js/20.584b2fee.js"><link rel="prefetch" href="/assets/js/21.1d95f196.js"><link rel="prefetch" href="/assets/js/22.1ceb24b9.js"><link rel="prefetch" href="/assets/js/23.4b842216.js"><link rel="prefetch" href="/assets/js/24.8c8e5ad0.js"><link rel="prefetch" href="/assets/js/25.4539488b.js"><link rel="prefetch" href="/assets/js/26.47f7249a.js"><link rel="prefetch" href="/assets/js/27.16cacf95.js"><link rel="prefetch" href="/assets/js/28.13672484.js"><link rel="prefetch" href="/assets/js/29.011841a6.js"><link rel="prefetch" href="/assets/js/30.3bfa8de1.js"><link rel="prefetch" href="/assets/js/31.686c7b08.js"><link rel="prefetch" href="/assets/js/32.e1c4063b.js"><link rel="prefetch" href="/assets/js/33.e6f26224.js"><link rel="prefetch" href="/assets/js/34.22cb4d84.js"><link rel="prefetch" href="/assets/js/35.83c3088e.js"><link rel="prefetch" href="/assets/js/36.f78ca9dc.js"><link rel="prefetch" href="/assets/js/37.1a16fd6c.js"><link rel="prefetch" href="/assets/js/38.d682e7d2.js"><link rel="prefetch" href="/assets/js/39.b05a35b6.js"><link rel="prefetch" href="/assets/js/4.0e9407dd.js"><link rel="prefetch" href="/assets/js/40.0694dee6.js"><link rel="prefetch" href="/assets/js/41.10404339.js"><link rel="prefetch" href="/assets/js/42.9ae4a641.js"><link rel="prefetch" href="/assets/js/43.18778874.js"><link rel="prefetch" href="/assets/js/44.a162c453.js"><link rel="prefetch" href="/assets/js/45.be3efbbf.js"><link rel="prefetch" href="/assets/js/46.26dab373.js"><link rel="prefetch" href="/assets/js/47.b64f7cc3.js"><link rel="prefetch" href="/assets/js/48.9868c525.js"><link rel="prefetch" href="/assets/js/49.1b08b57d.js"><link rel="prefetch" href="/assets/js/5.9e55a80e.js"><link rel="prefetch" href="/assets/js/6.0e1c5646.js"><link rel="prefetch" href="/assets/js/7.c44fa938.js"><link rel="prefetch" href="/assets/js/8.6ccf58c5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.38133fe5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-146b4d24><div data-v-146b4d24><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-146b4d24 data-v-146b4d24><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-146b4d24 data-v-146b4d24><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>cjinhuo</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>cjinhuo</span>
            
          <span data-v-64685f0e>2019 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-146b4d24><header class="navbar" data-v-146b4d24><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/avatar.png" alt="cjinhuo" class="logo"> <span class="site-name">cjinhuo</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/frontEnd/" class="nav-link"><i class="iconfont undefined"></i>
  frontEnd
</a></li><li class="dropdown-item"><!----> <a href="/categories/hobby/" class="nav-link"><i class="iconfont undefined"></i>
  hobby
</a></li><li class="dropdown-item"><!----> <a href="/categories/end/" class="nav-link"><i class="iconfont undefined"></i>
  end
</a></li><li class="dropdown-item"><!----> <a href="/categories/front/" class="nav-link"><i class="iconfont undefined"></i>
  front
</a></li><li class="dropdown-item"><!----> <a href="/categories/work/" class="nav-link"><i class="iconfont undefined"></i>
  work
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/cjinhuo" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/3421335917434744/posts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~chenjinhuo" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-npm"></i>
  NPM
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/doudoublog/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bokeyuan"></i>
  博客圆
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-146b4d24></div> <aside class="sidebar" data-v-146b4d24><div class="personal-info-wrapper" data-v-b038cec6><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-b038cec6> <h3 class="name" data-v-b038cec6>
    cjinhuo
  </h3> <div class="num" data-v-b038cec6><div data-v-b038cec6><h3 data-v-b038cec6>35</h3> <h6 data-v-b038cec6>Article</h6></div> <div data-v-b038cec6><h3 data-v-b038cec6>47</h3> <h6 data-v-b038cec6>Tag</h6></div></div> <hr data-v-b038cec6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/frontEnd/" class="nav-link"><i class="iconfont undefined"></i>
  frontEnd
</a></li><li class="dropdown-item"><!----> <a href="/categories/hobby/" class="nav-link"><i class="iconfont undefined"></i>
  hobby
</a></li><li class="dropdown-item"><!----> <a href="/categories/end/" class="nav-link"><i class="iconfont undefined"></i>
  end
</a></li><li class="dropdown-item"><!----> <a href="/categories/front/" class="nav-link"><i class="iconfont undefined"></i>
  front
</a></li><li class="dropdown-item"><!----> <a href="/categories/work/" class="nav-link"><i class="iconfont undefined"></i>
  work
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/cjinhuo" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/3421335917434744/posts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~chenjinhuo" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-npm"></i>
  NPM
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/doudoublog/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bokeyuan"></i>
  博客圆
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>中级前端工程师</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/frontEnd/2019/frontForIntermediate.html#在js中定义枚举的首选语法是什么" class="sidebar-link">在JS中定义枚举的首选语法是什么</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#js按位取反操作符" class="sidebar-link">JS按位取反操作符~</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#预备知识" class="sidebar-link">预备知识</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#原码" class="sidebar-link">原码</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#反码" class="sidebar-link">反码</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#补码" class="sidebar-link">补码</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#运算符" class="sidebar-link">~运算符</a></li></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#模拟实现一个完美的promise" class="sidebar-link">模拟实现一个完美的Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#promise-a-规范" class="sidebar-link">Promise/A+规范</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#要求" class="sidebar-link">要求</a></li></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#继承的几种方式" class="sidebar-link">继承的几种方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#原型继承" class="sidebar-link">原型继承</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#构造继承" class="sidebar-link">构造继承</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#混合模式" class="sidebar-link">混合模式</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#寄生组合模式" class="sidebar-link">寄生组合模式</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#es6中extends的实现" class="sidebar-link">ES6中extends的实现</a></li></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#js中new一个对象的过程" class="sidebar-link">js中new一个对象的过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#实现new" class="sidebar-link">实现new</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#箭头函数是否可以实例化" class="sidebar-link">箭头函数是否可以实例化</a></li></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#for与foreach的区别" class="sidebar-link">for与forEach的区别</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#装饰器的原理" class="sidebar-link">装饰器的原理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#eval-function" class="sidebar-link">eval&amp;&amp;Function</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#map-weakmap" class="sidebar-link">Map &amp;&amp; WeakMap</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#map" class="sidebar-link">Map</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#weakmap" class="sidebar-link">WeakMap</a></li><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#page-domcontentloaded-load-beforeunload-unload" class="sidebar-link">Page: DOMContentLoaded, load, beforeunload, unload</a></li></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#v8执行一段js代码的过程" class="sidebar-link">V8执行一段JS代码的过程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#栅格化布局" class="sidebar-link">栅格化布局</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#import-require" class="sidebar-link">import &amp;&amp; require</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#多使用位运算提高代码效率" class="sidebar-link">多使用位运算提高代码效率</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#console-log是异步还是同步" class="sidebar-link">console.log是异步还是同步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/frontEnd/2019/frontForIntermediate.html#node环境下的console-log" class="sidebar-link">node环境下的console.log</a></li></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#在请求帧动画中会经常操作dom节点，操作dom需要时间，怎么优化" class="sidebar-link">在请求帧动画中会经常操作dom节点，操作dom需要时间，怎么优化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/frontEnd/2019/frontForIntermediate.html#如何在-array-foreach-中正确使用-async" class="sidebar-link">如何在 Array.forEach 中正确使用 Async</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-146b4d24><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>中级前端工程师</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>cjinhuo</span>
            
          <span data-v-64685f0e>2019 - </span>
          2021
        </a></span></div></div> <div data-v-146b4d24><main class="page"><div class="page-title" style="display:none;"><h1>中级前端工程师</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>cjinhuo</span></i> <i class="iconfont reco-date" data-v-484a899e><span data-v-484a899e>2019-02-12</span></i> <!----> <i class="iconfont reco-tag tags" data-v-484a899e><span class="tag-item" data-v-484a899e>
      前端
    </span><span class="tag-item" data-v-484a899e>
      中级前端工程师
    </span><span class="tag-item" data-v-484a899e>
      面试题
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="在js中定义枚举的首选语法是什么"><a href="#在js中定义枚举的首选语法是什么" class="header-anchor">#</a> 在JS中定义枚举的首选语法是什么</h2> <div class="custom-block tip"><p class="custom-block-title">Object.freeze</p> <p>Object.freeze() 方法可以冻结一个对象。一个被冻结的对象再也不能被修改；冻结了一个对象则不能向这个对象添加新的属性，不能删除已有属性，不能修改该对象已有属性的可枚举性、可配置性、可写性，以及不能修改已有属性的值。此外，冻结一个对象后该对象的原型也不能被修改。freeze() 返回和传入的参数相同的对象。</p></div> <p>我们平常都是用<code>const</code>来定义对象枚举，但是<code>const</code>对应的对象的值还是可以改动的，所以Object.freeze更适合枚举。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> <span class="token number">42</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span>
<span class="token comment">// Throws an error in strict mode</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// expected output: 42</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>Object.freeze并没有递归冻结对象。</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  internal<span class="token operator">:</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span><span class="token number">123</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
obj1<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token string">'aValue'</span><span class="token punctuation">;</span>

obj1<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>a <span class="token comment">// 'aValue'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="js按位取反操作符"><a href="#js按位取反操作符" class="header-anchor">#</a> JS按位取反操作符~</h2> <h3 id="预备知识"><a href="#预备知识" class="header-anchor">#</a> 预备知识</h3> <div class="custom-block tip"><p>计算机中没法做减法的，它的减法是通过加法来实现，需要加上一个负数，所以不得不引入一个符号位。</p></div> <h3 id="原码"><a href="#原码" class="header-anchor">#</a> 原码</h3> <div class="custom-block tip"><p>是最简单的机器数表示法。用最高位表示符号位，‘1’表示负号，‘0’表示正号。其他位存放该数的二进制的绝对值。</p></div> <p>以带符号位的四位二进制值数为例：</p> <div class="custom-block tip"><p>1010: 最高位为'1'，表示这是一个负数，其他三位'010'，即<code>（0*2^2）+（1*2^1）+（0*2^0）=2</code>（‘^’表示幂运算符）所以1010表示十进制数（-2）。</p></div> <p>下图给出部份正负数数的二进制原码表示法
<img src="data:image/png;base64,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" alt="">
既然都有正负数了，那么我们开始运算:</p> <div class="custom-block tip"><p>0001+0010=0011    （1+2=3）
0000+1000=1000    （+0+（-0）=-0）
0001+1001=1010    （1+（-1）=-2）出现问题</p></div> <p>于是我们可以看到其实正数之间的加法通常是不会出错的，因为它就是一个很简单的二进制加法。</p> <p>而正数与负数相加，或负数与负数相加，就要引起莫名其妙的结果，这都是该死的符号位引起的。0分为+0和-0也是因他而起。</p> <p>所以原码，虽然直观易懂，易于正值转换。但用来实现加减法的话，运算规则总归是太复杂。于是反码来了。</p> <h3 id="反码"><a href="#反码" class="header-anchor">#</a> 反码</h3> <div class="custom-block tip"><p>我们知道，原码最大的问题就在于一个数加上他的相反数不等于零。</p></div> <p>例如：0001+1001=1010 (1+(-1)=-2) 0010+1010=1100 (2+(-2)=-4)</p> <div class="custom-block tip"><p>反码：正数的反码还是等于原码<br>
负数的反码就是他的原码除符号位外，按位取反，例子：<br>
3是正数，反码与原码相同，则可以表示为0011<br>
-3的原码是1011，符号位保持不变，低三位（011）按位取反得（100）<br>
所以-3的反码为1100<br></p></div> <p>那我们再试下，用反码的方式解决一下原码的问题：</p> <div class="custom-block tip"><p>0001+1110=1111 （1+（-1）= - 0）</p> <p>互为相反数相加等于0，解决。虽然是得到的结果是1111也就是-0，所以还不是很精确</p></div> <p>好，我们再试着做一下两个负数相加</p> <div class="custom-block tip"><p>1110（-1）+ 1101（-2）= 1011（-4）</p></div> <p>-1 + (-2) = -4 ?
为了解决以上问题，补码就登场了。</p> <h3 id="补码"><a href="#补码" class="header-anchor">#</a> 补码</h3> <div class="custom-block tip"><p class="custom-block-title">补码定义</p> <p>正数的补码等于他的原码</p> <p>负数的补码等于反码+1</p></div> <p>在《计算机组成原理中》，补码的另外一种算法 是</p> <div class="custom-block tip"><p>负数的补码等于他的原码自低位向高位，尾数的第一个‘1’及其右边的‘0’保持不变，左边的各位按位取反，符号位不变。</p> <p>那正数的补码呢？加上一个正数，加法器就直接可以实现。所以它的补码就还是它本身。</p></div> <p><strong>补码实例</strong> <img src="data:image/png;base64,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" alt="">
现在来看几个例子:</p> <div class="custom-block tip"><p class="custom-block-title">负数相加</p> <p>1111（-1）+1110（-2）=1101(-3)</p></div> <div class="custom-block tip"><p class="custom-block-title">正负数相加</p> <p>1000（-8） +0011（3）=1011(-5)</p> <p>1110 (-2) + 0011(3) = 0001(1)</p></div> <h3 id="运算符"><a href="#运算符" class="header-anchor">#</a> ~运算符</h3> <div class="custom-block tip"><p>作用于补码，将每一位二进制都取反:</p> <p>~5: ~0101(5) =&gt; 1010(-6)
~-1: ~1111(-1) =&gt; 0000(0)
~0:~0000(0) =&gt; 1111(-1)</p></div> <p>经常被用到indexOf，如果是没有找到返回-1时，可以用<code>!~-1</code>表示<code>true</code></p> <h2 id="模拟实现一个完美的promise"><a href="#模拟实现一个完美的promise" class="header-anchor">#</a> 模拟实现一个完美的Promise</h2> <div class="custom-block tip"><p>这里说的是模拟，所以用setTimeout来模拟，但是setTimeout是属于宏任务，原生的Promise是微任务。但是可以在调用上面最大程度模拟出来，模拟之前可以看看<a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer">PromiseA+规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，当我写完代码后，又画出了实现Promise的流程图。</p></div> <h3 id="promise-a-规范"><a href="#promise-a-规范" class="header-anchor">#</a> Promise/A+规范</h3> <div class="custom-block tip"><ol><li>'promise'是一个对象或者函数</li> <li>'thenable'是一个对象或者函数</li> <li>'value'是promise状态成功时的值</li> <li>'reason'是promise状态失败时的值
下面是：promise的属性，当然还有一些静态方法没有给出，比如：<code>Promise.resolve</code>、<code>Promise.race</code>、<code>Promise.all</code>等等</li></ol></div> <p><img src="/assets/img/mock-promise-property.5e21f803.png" alt=""></p> <h3 id="要求"><a href="#要求" class="header-anchor">#</a> 要求</h3> <ol><li>一个promise必须有3个状态，pending，fulfilled(resolved)，rejected当处于pending状态的时候，可以转移到fulfilled(resolved)或者rejected状态。当处于fulfilled(resolved)状态或者rejected状态的时候，就不可变。</li> <li>一个promise必须有一个then方法，then方法接受两个参数：<br>
其中onFulfilled方法表示状态从pending——&gt;fulfilled(resolved)时所执行的方法，而onRejected表示状态从pending——&gt;rejected所执行的方法。<br> <code>promise.then(onFulfilled,onRejected)</code></li> <li>为了实现链式调用，then方法必须返回一个新的<code>Promise</code>，并且将上一个promise的状态传入到新的promise上，以便后面的链式调用，可以在then返回一个一个promise，<code>return new Promise()</code>，所以我们新建了一个<code>resolvePromise</code>函数来处理这块逻辑。
下面使用ES6的class完整的模拟的Promise</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'pending'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span> <span class="token comment">// status为resolved时返回的值</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span> <span class="token comment">// status为rejected时返回的值</span>
    <span class="token comment">// 用来保存then传进来的函数，当状态改变时调用，声明成数组的原因是一个promise可能多处定义then或catch</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onFullfilledArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 由于resolve、reject都是在类外面执行的，所以需要绑定this</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** 传入两个promise，将第二个的promise的value或者reason转移到currentPromise
 * @callback resolve
 * @callback reject
 * @param {Promise} currentPromise 当前promise对象
 * @param {*} x 当前resolve或者reject之后的结果
 * @param {resolve} resolve 当前promise对象的resolve
 * @param {reject} reject 当前promise对象的reject
 */</span>
  <span class="token keyword">static</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">currentPromise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentPromise <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 如果结果x存在且是对象或者是一个函数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> used<span class="token punctuation">;</span> <span class="token comment">// then(cb1,cb2)cb1,cb2两者只能调用其中一个</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> then <span class="token operator">=</span> x<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
        <span class="token comment">// 如果返回值x有then函数，则</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>used<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            used <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            MyPromise<span class="token punctuation">.</span><span class="token function">resolvePromise</span><span class="token punctuation">(</span>currentPromise<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>used<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            used <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>used<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
          used <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>used<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        used <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'rejected'</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> error
      <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedArray<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行then传的函数</span>
        <span class="token function">f</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// console.log('reject', error)</span>
  <span class="token punctuation">}</span>

  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'resolved'</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
      <span class="token keyword">this</span><span class="token punctuation">.</span>onFullfilledArray<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行then传的函数</span>
        <span class="token function">f</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// console.log('resolved', value)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// then函数可以传一个或两个函数</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFullfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    onFullfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFullfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onFullfilled</span> <span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">;</span>
    onRejected <span class="token operator">=</span> <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onRejected</span> <span class="token operator">:</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> err <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tempPromise<span class="token punctuation">,</span>
      self <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'pending'</span><span class="token operator">:</span>
        tempPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 保存.then传的第一个函数</span>
          self<span class="token punctuation">.</span>onFullfilledArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFullfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                MyPromise<span class="token punctuation">.</span><span class="token function">resolvePromise</span><span class="token punctuation">(</span>tempPromise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
              <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token comment">// 保存.then传的第二个函数</span>
            self<span class="token punctuation">.</span>onRejectedArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
                    MyPromise<span class="token punctuation">.</span><span class="token function">resolvePromise</span><span class="token punctuation">(</span>tempPromise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'resolved'</span><span class="token operator">:</span>
        tempPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFullfilled</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
                MyPromise<span class="token punctuation">.</span><span class="token function">resolvePromise</span><span class="token punctuation">(</span>tempPromise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'rejected'</span><span class="token operator">:</span>
        tempPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
                MyPromise<span class="token punctuation">.</span><span class="token function">resolvePromise</span><span class="token punctuation">(</span>tempPromise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> tempPromise
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br></div></div><p>为了更好的理解这段代码，画出了一个流程图:
<img src="/assets/img/mock-promise-flowchart.602942eb.png" alt=""></p> <h2 id="继承的几种方式"><a href="#继承的几种方式" class="header-anchor">#</a> 继承的几种方式</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 属性</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'father'</span><span class="token punctuation">,</span>
    <span class="token comment">// 实例方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;正在睡觉&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 原型方法</span>
<span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">look</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">book</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;正在看:&quot;</span> <span class="token operator">+</span> book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="原型继承"><a href="#原型继承" class="header-anchor">#</a> 原型继承</h3> <p>父类中私有的和公有的都继承到了子类原型上</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Son</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 重写了Son的原型</span>
<span class="token class-name">Son</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Son
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="构造继承"><a href="#构造继承" class="header-anchor">#</a> 构造继承</h3> <p>只是将Father的私有属性拷贝一份给Son，并没有将原型链指向Father</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Father</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="混合模式"><a href="#混合模式" class="header-anchor">#</a> 混合模式</h3> <p>有点弊端，会实例化两次Father，而且Father的私有属性也会在Son的原型上</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Father</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token class-name">Son</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token class-name">Son</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Son
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="寄生组合模式"><a href="#寄生组合模式" class="header-anchor">#</a> 寄生组合模式</h3> <p>解决了混合模式的弊端</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Father</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// Object.create的Polyfill</span>
<span class="token keyword">function</span> <span class="token function">myCreate</span><span class="token punctuation">(</span><span class="token parameter">proto</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  fn<span class="token punctuation">.</span>prototype <span class="token operator">=</span> proto
  <span class="token keyword">return</span> fn
<span class="token punctuation">}</span>
<span class="token class-name">Son</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token function">myCreate</span><span class="token punctuation">(</span><span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
<span class="token class-name">Son</span><span class="token punctuation">.</span>constructor <span class="token operator">=</span> Son
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">注意</p> <p>如果将<code>Son.prototype = myCreate(Father.prototype)</code>改成<code>Son.prototype = Father.prototype</code>，虽然还是继承了，但是Father的原型和Son的原型是同一个引用地址，所以改动Son.prototype时就会将Father一起改动。</p></div> <h3 id="es6中extends的实现"><a href="#es6中extends的实现" class="header-anchor">#</a> ES6中extends的实现</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Father</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token class-name">Son</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span>
  <span class="token punctuation">{</span> constructor<span class="token operator">:</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> Son<span class="token punctuation">,</span> writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> configurable<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Son.__proto__ = Father</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="js中new一个对象的过程"><a href="#js中new一个对象的过程" class="header-anchor">#</a> js中new一个对象的过程</h2> <div class="custom-block tip"><p class="custom-block-title">MDN原文</p> <p>首先了解new做了什么，使用new关键字调用函数（new ClassA(…)）的具体步骤：</p> <ol><li><p>Creates a blank, plain JavaScript object;</p></li> <li><p>Links (sets the constructor of) this object to another object;</p></li> <li><p>Passes the newly created object from Step 1 as the this context;</p></li> <li><p>Returns this if the function doesn't return its own object.</p></li> <li><p>创建一个空的简单JavaScript对象（即{}）；</p></li> <li><p>链接该对象（即设置该对象的构造函数）到另一个对象 ；</p></li> <li><p>将步骤1新创建的对象作为this的上下文 ；</p></li> <li><p>如果该函数没有返回对象，则返回this。</p></li></ol></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// a的构造器</span>
a<span class="token punctuation">.</span>constructor <span class="token comment">// ƒ Object() { [native code] }</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Uncaught TypeError: a is not a constructor</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>a</code>的构造器是指向<code>Object()</code>函数，不是它自己的，所以不能实例化，所以我们只能这样<code>let c = Object()</code>。</p> <p><code>class</code>也有自己的构造器（class其实就是function），所以也可以实例化，其他的都没办法实例化</p> <h3 id="实现new"><a href="#实现new" class="header-anchor">#</a> 实现new</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myNew</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> protoObj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">target</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>protoObj<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> result <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">?</span> result <span class="token operator">:</span> protoObj
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'aa'</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age <span class="token operator">||</span> <span class="token number">18</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">myNew</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token string">'cjh'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// A { name: 'cjh', age: 16 }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="箭头函数是否可以实例化"><a href="#箭头函数是否可以实例化" class="header-anchor">#</a> 箭头函数是否可以实例化</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">fun1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fun1<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fun2<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span> <span class="token comment">// {constructor: ƒ}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>箭头函数没有prototype、没有自己的this指向、不可以使用arguments，而new的过程中有个操作是将__proto__指向prototype，所以不能用new实例化箭头函数</p> <h2 id="for与foreach的区别"><a href="#for与foreach的区别" class="header-anchor">#</a> for与forEach的区别</h2> <div class="custom-block tip"><p>for循环每一次遍历都会重新检查跳出的条件，比如数组的长度，但是forEach只会保存第一次的数组长度。</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>

arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>item <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 输出： 1 2 3</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出：1 2 3 4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="装饰器的原理"><a href="#装饰器的原理" class="header-anchor">#</a> 装饰器的原理</h2> <div class="custom-block tip"><p class="custom-block-title">分类</p> <p>装饰器分为两类：作用于类的装饰器、作用于方法的装饰器，底层都是函数。</p></div> <ul><li>作用于类的装饰器，写法举例</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">log</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 默认传参为 被修饰的类</span>
    target<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">logger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'装饰器--被调用'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@log       <span class="token comment">// log 必须是函数</span>
<span class="token keyword">class</span> <span class="token class-name">Myclass</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Myclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 装饰器--被调用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>作用于方法的装饰器，写法举例</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>
   @<span class="token function">readonly</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">method</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">readonly</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// target: 类原型</span>
   <span class="token comment">// key:    被修饰的属性或者方法</span>
   <span class="token comment">// descriptor: 被修饰的属性或方法的描述符对象</span>
   <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> descriptor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      descriptor<span class="token punctuation">.</span>writable <span class="token operator">=</span> <span class="token operator">!</span>value<span class="token punctuation">;</span>
      <span class="token keyword">return</span> descriptor<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
c<span class="token punctuation">.</span><span class="token function-variable function">method</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment">// 重写了method这个类方法</span>
c<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// cat  =&gt; 设置属性只读成功</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="eval-function"><a href="#eval-function" class="header-anchor">#</a> eval&amp;&amp;Function</h2> <div class="custom-block tip"><p class="custom-block-title">eval</p> <p>eval可以取到上下文，但是在ES5后有个硬性规定：通过一个引用来调用它，而不是直接的调用 eval。 从 ECMAScript 5 起，它工作在全局作用域下，而不是局部作用域中。这就意味着，例如，下面的代码的作用声明创建一个全局函数，并且 eval 中的这些代码在执行期间不能在被调用的作用域中访问局部变量</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'x + y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 直接调用，使用本地作用域，结果是 6</span>
  <span class="token keyword">var</span> geval <span class="token operator">=</span> eval<span class="token punctuation">;</span> <span class="token comment">// 等价于在全局作用域调用</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">geval</span><span class="token punctuation">(</span><span class="token string">'x + y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 间接调用，使用全局作用域，throws ReferenceError 因为`x`未定义</span>
  <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> eval<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'x + y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 另一个间接调用的例子</span>
​<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <div class="custom-block tip"><p class="custom-block-title">Function</p> <p>与eval不同的是它可以入参，还有不同的就是作用域总是指向全局作用域。</p></div> <p>MDN原文：</p> <p>Functions created with the Function constructor do not create closures to their creation contexts; they always are created in the global scope. When running them, they will only be able to access their own local variables and global ones, not the ones from the scope in which the Function constructor was created. This is different from using eval with code for a function expression.</p> <p>翻译：</p> <p>使用函数构造函数创建的函数不会对其创建上下文创建闭包;它们总是在全局范围内创建的。在运行它们时，它们只能访问自己的局部变量和全局变量，而不能访问创建函数构造函数的作用域中的变量。这不同于对函数表达式的代码使用eval。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createFunction1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">'return x;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里的 x 指向最上面全局作用域内的 x</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createFunction2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> x<span class="token punctuation">;</span> <span class="token comment">// 这里的 x 指向上方本地作用域内的 x</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> f1 <span class="token operator">=</span> <span class="token function">createFunction1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 10</span>
<span class="token keyword">var</span> f2 <span class="token operator">=</span> <span class="token function">createFunction2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="map-weakmap"><a href="#map-weakmap" class="header-anchor">#</a> Map &amp;&amp; WeakMap</h2> <div class="custom-block tip"><p class="custom-block-title">WeakMap存在的意义</p> <p>WeakMap的专用场合就是防止内存泄漏，它的键所对应的对象，可能会在将来消失，WeakMap就会自动清除这个引用，而不是额外保留一份。</p></div> <h3 id="map"><a href="#map" class="header-anchor">#</a> Map</h3> <p>让我们先理解Map的基本用法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token comment">// obj对象引用的计数是1</span>
<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'66'</span><span class="token punctuation">)</span> <span class="token comment">// obj对象引用的计数是2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// { test: 2 }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// '66'</span>
obj<span class="token punctuation">.</span>one <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment">// 由于对应的是引用地址，所以还是可以取的到</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// { test: 2, one: 1 }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// '66'</span>
obj <span class="token operator">=</span> <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> one<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 'null'</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// obj对象引用的计数是1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span> <span class="token comment">// Map { { test: 2, one: 1 } =&gt; '66' }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>从上面的例子可以看出，不管<code>obj</code>里面的值怎么变，都可以拿到对应的值，除非是赋值然后引用地址变了，才取不到<code>map</code>的值。最后将<code>obj</code>置为<code>null</code>，<code>obj</code>对象引用的计数变为1，还是不会被垃圾回收机制回收。</p> <h3 id="weakmap"><a href="#weakmap" class="header-anchor">#</a> WeakMap</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token comment">// obj对象引用的计数是1</span>
<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// obj对象引用的计数是1</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'66'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 'null'</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// obj对象引用的计数是0 随时会被垃圾回收，其实map里面也没有了这个键值对</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span> <span class="token comment">// WeakMap { [items unknown] }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>WeakMap经常在保存节点时有用，请看下面例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> wm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
wm<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token string">'some information'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
wm<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token comment">// &quot;some information&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上面代码中，先新建一个 <code>Weakmap</code> 实例。然后，将一个 DOM 节点作为键名存入该实例，并将一些附加信息作为键值，一起存放在 <code>WeakMap</code> 里面。这时，<code>WeakMap</code> 里面对<code>element</code>的引用就是弱引用，不会被计入垃圾回收机制。</p> <p>也就是说，上面的 <code>DOM</code> 节点对象的引用计数是<code>1</code>，而不是<code>2</code>。这时，一旦消除对该节点的引用，它占用的内存就会被垃圾回收机制释放。<code>Weakmap</code> 保存的这个键值对，也会自动消失。</p> <h3 id="page-domcontentloaded-load-beforeunload-unload"><a href="#page-domcontentloaded-load-beforeunload-unload" class="header-anchor">#</a> Page: DOMContentLoaded, load, beforeunload, unload</h3> <ul><li>DOMContentLoaded：浏览器已经加载完HTML、dom tree已经构建完成，但是外部资源像<code>&lt;img&gt;</code>标签和样式表还没有被加载</li> <li>load 不仅html已经被加载了，而且外部资源、图片、样式也被加载完</li> <li>beforeunload/unload：用户离开页面时会发生的事件，beforeunload用于用户要离开：我们可以检查用户是否保存了更改并询问他们是否真的要离开，unload用于用户几乎离开了，但我们仍然可以启动一些操作，例如发送统计信息</li></ul> <h2 id="v8执行一段js代码的过程"><a href="#v8执行一段js代码的过程" class="header-anchor">#</a> V8执行一段JS代码的过程</h2> <div class="custom-block tip"><p>首先明白的是，机器是读不懂JS代码，机器只能理解特定的机器码，那如果要让JS的逻辑在机器运行起来，就必须将JS的代码翻译成机器码，然后让机器识别。JS属于解释新型语言，对于解释型的语言说，解释器会对源码做如下分析：</p> <ul><li>通过词法分析和语法分析生成AST(抽象语法树)</li> <li>生成字节码</li></ul></div> <ol><li>生成AST
生成AST分为两步--词法分析和语法分析</li></ol> <h2 id="栅格化布局"><a href="#栅格化布局" class="header-anchor">#</a> 栅格化布局</h2> <p>利用flex可以实现</p> <h2 id="import-require"><a href="#import-require" class="header-anchor">#</a> import &amp;&amp; require</h2> <div class="custom-block tip"><p class="custom-block-title">import</p> <p>编译时调用，就会生成一个只读引用。等到脚本真正执行时，再根据这个只读引用，到被加载的那个模块里面去取值。由于是在编译时调用，所以<code>webpack</code>可以通过<code>import</code>的特性来产生依赖图谱。</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// dep.js</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>

<span class="token comment">// app.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dep'</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在<code>import {a} from f</code>的时候，他其实在你引用的地方和倒出的地方的<code>a</code>之间建立了连接，即它们是指向同一内存的，即便是原始数据类型，你修改模块中的指也会导致引用处的变化</p> <div class="custom-block tip"><p class="custom-block-title">require</p> <p>运行时调用，输出的是一个值的拷贝（浅拷贝），一旦输出一个值，模块内部的变化就影响不到这个值，由于是浅拷贝所以改对象中的值还是会对应更改的</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// lib.js</span>
<span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">3</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">incCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  counter<span class="token operator">++</span>
  obj<span class="token punctuation">.</span>test<span class="token operator">++</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  counter<span class="token operator">:</span> counter<span class="token punctuation">,</span>
  incCounter<span class="token operator">:</span> incCounter<span class="token punctuation">,</span>
  obj<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// main.js</span>
<span class="token comment">// main.js</span>
<span class="token keyword">var</span> mod <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./demo'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span>counter<span class="token punctuation">)</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>test<span class="token punctuation">)</span> <span class="token comment">// 1</span>
mod<span class="token punctuation">.</span><span class="token function">incCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span>counter<span class="token punctuation">)</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>test<span class="token punctuation">)</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></div> <h2 id="多使用位运算提高代码效率"><a href="#多使用位运算提高代码效率" class="header-anchor">#</a> 多使用位运算提高代码效率</h2> <div class="custom-block tip"><p class="custom-block-title">JS代码编译步骤</p> <p>1： js代码 经历 词法分析，成为token
2： 然后经过语法分析，将token转换成AST(抽象语法树)
3： 用解释器根据AST，生成字节码
4： 使用JIT即时编译技术，将字节码转成机器码，然后计算机就可以识别执行了。</p></div> <p>所以我们使用判断奇偶数的时候用<code>8 &amp; 1</code>或<code>8 % 2</code>就有区别了，机器码其实就是二进制，所以<code>8 &amp; 1</code>只需要运算<code>1000 &amp; 0001</code>，而<code>8 % 2</code>中%需要转成机器码能识别的运算符，所以位运算就会快一点。</p> <h2 id="console-log是异步还是同步"><a href="#console-log是异步还是同步" class="header-anchor">#</a> console.log是异步还是同步</h2> <p>我们先看下面得例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  b <span class="token operator">:</span> <span class="token punctuation">{</span>
    c<span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
a<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/assets/img/console-1.ea081264.png" alt="">
咋一看好像是异步的，但是为什么数字就是同步的呢？其实里面有个坑，我们都知道对象是引用类型，所以<code>console.log</code>打印引用类型的时候是打印指针指向的引用地址的内容，我们手动展开的时候其实是调用了当前对象的<code>get</code>方法，这是才去读取改引用地址里面的内容，导致一些人说console.log是异步。
<img src="/assets/img/console-2.c787c676.png" alt=""></p> <h3 id="node环境下的console-log"><a href="#node环境下的console-log" class="header-anchor">#</a> node环境下的console.log</h3> <div class="custom-block tip"><p class="custom-block-title">node下的console.log</p> <p>我们首先要知道Node.js中实现console.log的原理
function log() { process.stdout.write( util.format.apply(this, arguments); )}
等同于问process.stdout.write是同步还是异步的？
其实官方文档已经给出了答案,A note on process I/O
process.stdout和process.stderr是根据系统环境来判定的同步还是异步的
Files: synchronous on Windows and Linux
TTYs (Terminals): asynchronous on Windows, synchronous on Unix
Pipes (and sockets): synchronous on Windows, asynchronous on Unix
那么console.log也是根据系统环境来判定同步还是异步的。</p></div> <h2 id="在请求帧动画中会经常操作dom节点，操作dom需要时间，怎么优化"><a href="#在请求帧动画中会经常操作dom节点，操作dom需要时间，怎么优化" class="header-anchor">#</a> 在请求帧动画中会经常操作dom节点，操作dom需要时间，怎么优化</h2> <h2 id="如何在-array-foreach-中正确使用-async"><a href="#如何在-array-foreach-中正确使用-async" class="header-anchor">#</a> 如何在 Array.forEach 中正确使用 Async</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">delay<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">-</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 输出：</span>
<span class="token comment">// 3</span>
<span class="token comment">// 2</span>
<span class="token comment">// 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>上面输出3、2、1，说明await是没有生效的，看了forEach的Polyfill就知道，是在一个while循环里面执行的，相当于上面是三个函数一起执行，我们想要的效果是第一个函数执行完再执行第二个函数，我们可以用reduce</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">delay<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">initial<span class="token punctuation">,</span> v<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token comment">// 因为此时的initial是上一个函数的返回值，如果没有promise没有执行完，会在await的关键字下停顿</span>
 <span class="token keyword">await</span> initial
 <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">-</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">// 输出：</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span>
<span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>我们可以看到reduce的Polyfill:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>reduce<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'reduce'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>callback <span class="token comment">/*, initialValue */</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// ...more</span>
     <span class="token keyword">while</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token keyword">in</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> o<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> o<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
       k<span class="token operator">++</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">return</span> value
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>可以看到value就是<code>initial</code>，从<code>value = callback(value, o[k], k, o)</code>可以看出来initial保存这上一个函数的返回值，由于我们用了<code>aysnc</code>所以会返回一个<code>promise</code>对象，然后用<code>await initial</code>后可以在当前函数停顿。</p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/28/2021, 3:32:30 PM</span></div></footer> <!----></main> <!----> <div style="display:none;" data-v-146b4d24 data-v-146b4d24><div class="comments-wrapper" data-v-146b4d24><div class="valine-wrapper"><div id="valine"></div></div></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div></div></div>
    <script src="/assets/js/app.f855a051.js" defer></script><script src="/assets/js/3.a8cb06ec.js" defer></script><script src="/assets/js/1.26bd7cad.js" defer></script><script src="/assets/js/9.95c7eff9.js" defer></script>
  </body>
</html>
