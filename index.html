<!DOCTYPE html>
<html>
  <head>
    <title>SRI 示例</title>
    <!-- 引入 jQuery CDN 库并启用 SRI 技术 -->
  </head>

  <body>
    <h1>Hello World!</h1>
    <!-- <button
      onclick="(() => {
      console.log(1)
    })()">
      test
    </button> -->
  </body>
  <script>
    ;(function (n, e, r, t, a, o, s, i, c, l, f, m, p, u) {
      o = 'precollect'
      s = 'getAttribute'
      i = 'addEventListener'
      c = 'PerformanceObserver'
      l = function (e) {
        f = [].slice.call(arguments)
        f.push(Date.now(), location.href)
        ;(e == o ? l.p.a : l.q).push(f)
      }
      l.q = []
      l.p = { a: [] }
      n[a] = l

      m = document.createElement('script')
      m.src = r + '?aid=' + t + '&globalName=' + a
      m.crossorigin = 'anonymous'
      e.getElementsByTagName('head')[0].appendChild(m)
      if (i in n) {
        l.pcErr = function (e) {
          e = e || n.event
          p = e.target || e.srcElement
          if (p instanceof Element || p instanceof HTMLElement) {
            n[a](o, 'st', { tagName: p.tagName, url: p[s]('href') || p[s]('src') })
          } else {
            n[a](o, 'err', e.error || e.message)
          }
        }
        l.pcRej = function (e) {
          e = e || n.event
          n[a](o, 'reject', e.reason || (e.detail && e.detail.reason))
        }
        n[i]('error', l.pcErr, true)
        n[i]('unhandledrejection', l.pcRej, true)
      }
      if ('PerformanceLongTaskTiming' in n) {
        u = l.pp = { entries: [] }
        u.observer = new PerformanceObserver(function (e) {
          console.log('PerformanceObserver', e)
          u.entries = u.entries.concat(e.getEntries())
        })
        u.observer.observe({ entryTypes: ['longtask', 'largest-contentful-paint', 'layout-shift'] })
      }
    })(window, document, 'https://lf3-short.ibytedapm.com/slardar/fe/sdk-web/browser.1.8.1.cn.js', 0, 'apmPlus')
    window.apmPlus('init', {
      bid: 'xx',
      useLocalConfig: true,
    })
    setTimeout(function () {
      var xhr = new XMLHttpRequest()
      var url = 'http://10.86.124.38:8080/input.js'
      xhr.open('GET', url, true)
      xhr.send()
    }, 2000)
    window.apmPlus('on', 'beforeSend', function (e) {
      if (e.ev_type === 'resource') {
        var test = {
          test: 1,
          timing: e.payload,
        }
        console.log('toJSON value', e.payload.toJSON)
        console.log('direct', JSON.stringify(e.payload)) // {}
        console.log('test', JSON.stringify(test)) // {}
        if (e.payload.toJSON) {
          console.log('has toJSON', e.payload.toJSON())
        }
      }
      return e
    })
    window.apmPlus('start')
  </script>
  <script src="https://sf16-short-va.bytedapm.com/slardar/fe/sdk-web/screenshot.min.js"></script>
</html>
