---
import BaseHead from '../components/BaseHead.astro'
import Header from '@/components/Header/Header.astro'
import Footer from '../components/Footer.astro'
import BlogTimeline from '@/components/Timeline/BlogTimeline'
import { getSortedBlogPosts, getAllTags, groupPostsByYearMonth } from '@/shared/blog'

const posts = await getSortedBlogPosts()
const allTags = getAllTags(posts)
const timelineData = groupPostsByYearMonth(posts)

const serializedData = timelineData.map((yearData) => ({
	year: yearData.year,
	totalPosts: yearData.totalPosts,
	months: yearData.months.map((monthData) => ({
		month: monthData.month,
		monthName: monthData.monthName,
		posts: monthData.posts.map((post) => ({
			id: post.id,
			title: post.data.title,
			description: post.data.description,
			pubDate: post.data.pubDate,
			author: post.data.author,
			authorHref: post.data.authorHref,
			tags: post.data.tags,
		})),
	})),
}))
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <BaseHead title="All Posts" />
  </head>
  <body class="bg-skin-background">
    <Header />
    <main class="min-h-screen">
      <section class="max-w-5xl mx-auto px-6 md:px-12 py-12">
        <h1 class="text-4xl font-bold text-skin-neutral-1 mb-8">All Posts</h1>
        <BlogTimeline client:load initialData={serializedData} allTags={allTags} />
      </section>
    </main>
    <Footer />
  </body>
</html>
