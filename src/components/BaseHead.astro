---
// all pages through the use of the <BaseHead /> component.
import '@fontsource-variable/roboto'
import '../styles/global.css'
import { SITE_TITLE, SITE_DESCRIPTION } from '../config'

export interface Props {
  title?: string
  description?: string
  image?: string
  author?: string
  authorHref?: string
  pubDate?: string
  updatedDate?: string
  type?: 'website' | 'article'
  tags?: string[]
}

const { 
  title = SITE_TITLE, 
  description = SITE_DESCRIPTION, 
  image = '/placeholder-social.jpg',
  author = 'Shanks',
  authorHref = 'https://github.com/cjinhuo',
  pubDate,
  updatedDate,
  type = 'website',
  tags = []
} = Astro.props

const canonicalURL = new URL(Astro.url.pathname, Astro.site)
const socialImageURL = new URL(image, Astro.url)
---

<script is:inline>
  const initThemeFromLocalStorage = () => {
    const Dark = 'dark'
    const Light = 'light'
    const localStorageKey = '__shanks__theme'
    const addDarkToClassList = () => document.documentElement.classList.add(Dark)
    const removeDarkToClassList = () => document.documentElement.classList.remove(Dark)
    const media = window.matchMedia('(prefers-color-scheme: dark)')
    const colorSchemeChange = (e) => {
      if (e.matches) {
        localStorage.setItem(localStorageKey, Dark)
        addDarkToClassList()
      } else {
        localStorage.setItem(localStorageKey, Light)
        removeDarkToClassList()
      }
    }
    if (typeof media.addEventListener === 'function') media.addEventListener('change', colorSchemeChange)
    const theme = (() => {
      if (typeof localStorage !== 'undefined' && localStorage.getItem(localStorageKey)) {
        return localStorage.getItem(localStorageKey)
      }
      if (media.matches) {
        localStorage.setItem(localStorageKey, Dark)
        return Dark
      }
      return Light
    })()
    if (theme && theme === Dark) {
      addDarkToClassList()
    } else {
      removeDarkToClassList()
    }
  }
  initThemeFromLocalStorage()
  document.addEventListener('astro:after-swap', () => {
    initThemeFromLocalStorage()
  })
</script>
<!-- Global Metadata -->
<meta charset='utf-8' />
<meta name='viewport' content='width=device-width,initial-scale=1' />
<link rel='icon' type='image/svg+xml' href='/favicon.svg' />
<meta name='generator' content={Astro.generator} />

<!-- Canonical URL -->
<link rel='canonical' href={canonicalURL} />

<!-- Primary Meta Tags -->
<title>{title}</title>
<meta name='title' content={title} />
<meta name='description' content={description} />
{author && <meta name='author' content={author} />}
{tags.length > 0 && <meta name='keywords' content={tags.join(', ')} />}

<!-- Open Graph / Facebook -->
<meta property='og:type' content={type} />
<meta property='og:url' content={Astro.url} />
<meta property='og:title' content={title} />
<meta property='og:description' content={description} />
<meta property='og:image' content={socialImageURL} />
<meta property='og:site_name' content={SITE_TITLE} />
{type === 'article' && author && <meta property='article:author' content={author} />}
{type === 'article' && pubDate && <meta property='article:published_time' content={pubDate} />}
{type === 'article' && updatedDate && <meta property='article:modified_time' content={updatedDate} />}
{type === 'article' && tags.map(tag => <meta property='article:tag' content={tag} />)}

<!-- Twitter -->
<meta property='twitter:card' content='summary_large_image' />
<meta property='twitter:url' content={Astro.url} />
<meta property='twitter:title' content={title} />
<meta property='twitter:description' content={description} />
<meta property='twitter:image' content={socialImageURL} />
{author && <meta property='twitter:creator' content={authorHref} />}

<!-- Additional SEO -->
<meta name='robots' content='index, follow' />
<meta name='googlebot' content='index, follow' />

<!-- keywords -->
<meta
  data-react-helmet='true'
  name='keywords'
  content='前端监控,小程序监控,mitojs,cjinhuo,web monitoring,mini program monitoring,shanks,blogs,'
/>
<!-- description -->
<meta data-react-helmet='true' name='description' content='shank blog' />

<!-- sharecontent -->
<meta
  data-react-helmet='true'
  name='sharecontent'
  data-msg-img='./cjinhuo_blog.webp'
  data-msg-title='Shanks Blog'
  data-msg-content='前端监控,小程序监控,mitojs,cjinhuo,web monitoring,mini program monitoring,shanks,blogs'
/>

<!-- JSON-LD Structured Data -->
{type === 'article' && (
  <script type='application/ld+json'>
    {JSON.stringify({
      '@context': 'https://schema.org',
      '@type': 'Article',
      headline: title,
      description: description,
      image: socialImageURL.toString(),
      author: {
        '@type': 'Person',
        name: author,
        url: authorHref
      },
      publisher: {
        '@type': 'Organization',
        name: SITE_TITLE,
        logo: {
          '@type': 'ImageObject',
          url: new URL('/favicon.svg', Astro.url).toString()
        }
      },
      datePublished: pubDate,
      dateModified: updatedDate || pubDate,
      mainEntityOfPage: {
        '@type': 'WebPage',
        '@id': canonicalURL.toString()
      }
    })}
  </script>
)}
